@using System.Collections.Immutable
@using Microsoft.CodeAnalysis
@using SharpIDE.Application.Features.Analysis
@using SharpIDE.Application.Features.SolutionDiscovery.VsPersistence

@if (_diagnostics.Length is not 0)
{
	<MudTreeViewItem T="string" TextTypo="Typo.body2" EndTextTypo="Typo.caption" Expanded="true" Icon="@Icons.Material.Filled.Code" IconColor="Color.Success" Value="@ProjectModel.Name" Text="@ProjectModel.Name" EndText="@($"{_diagnostics.Length} diagnostics")">
		@foreach (var diagnostic in _diagnostics)
		{
			<MudTreeViewItem T="string" TextTypo="Typo.body2" Icon="@Icons.Material.Filled.Folder" IconColor="Color.Primary" Value="@diagnostic.Id" Text="@diagnostic.Id">
			</MudTreeViewItem>
		}
	</MudTreeViewItem>
}

@code {
	[Parameter, EditorRequired]
	public SharpIdeProjectModel ProjectModel { get; set; } = null!;

	private ImmutableArray<Diagnostic> _diagnostics = [];

	protected override async Task OnInitializedAsync()
	{
		var diagnostics = await RoslynAnalysis.GetProjectDiagnostics(ProjectModel);
		_diagnostics = diagnostics;
	}

}
